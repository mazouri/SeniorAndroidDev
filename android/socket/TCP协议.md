# TCP协议

## 什么是TCP协议？

TCP是Transmission Control Protocol的缩写，也就是传输控制协议，它是一种传输层通信协议。

> 基于TCP的应用层协议有**FTP**、**Telnet**、**SMTP**、**HTTP**、**POP3**与**DNS**

## TCP协议有什么特点？

TCP协议是面向连接、面向字节流、全双工通信、可靠的。

### 1.面向连接？（像打电话）

指的是要使用TCP传输数据，必须先建立TCP连接，传输完成后释放连接，就像打电话一样必须先拨号建立一条连接，打完后挂机释放连接

### 2.面向字节流？

流，指的是流入到进程或从进程流出的字符序列。

简单来说，虽然有时候要传输的数据流太大，TCP报文长度有限制，不能一次传输完，要把它分为好几个数据块，但是由于可靠性保证，接收方可以按顺序接收数据块然后重新组成分块之前的数据流，所以TCP看起来就像直接互相传输字节流一样，面向字节流

### 3.全双工通信？

一旦建立了TCP连接，通信双方可以在任何时候都能发送数据

### 4.可靠的

指的是通过TCP连接传送的数据，无差错，不丢失，不重复，并且按序到达。

## TCP建立连接时的三次握手

<img src="http://upload-images.jianshu.io/upload_images/944365-ca6e707d5bef40fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">

使用TCP建立连接时必须进行三次握手。若A要与B进行连接，则必须：

- 第一次握手：建立连接。客户端发送连接请求报文段，将SYN位置为1，Sequence Number为x；然后，客户端进入SYN_SEND状态，等待服务器的确认。即A发送信息给B
- 第二次握手：服务器收到客户端的SYN报文段，需要对这个SYN报文段进行确认。即B收到连接信息后向A返回确认信息
- 第三次握手：客户端收到服务器的（SYN+ACK）报文段，并向服务器发送ACK报文段。即A收到确认信息后再次向B返回确认连接信息

> 此时，A告诉自己上层连接建立；B收到连接信息后告诉上层连接建立。

**这样就完成TCP三次握手 = 一条TCP连接建立完成 = 可以开始发送数据**

> 注意：三次握手期间任何一次未收到对面回复都要重发
> 最后一个确认报文段发送完毕以后，客户端和服务器端都进入ESTABLISHED状态。




