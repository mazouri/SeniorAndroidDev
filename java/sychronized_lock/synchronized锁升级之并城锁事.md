# synchronized锁升级之并城锁事

“并城”里有个王府，里面存放着各式个样的锁，用这些锁来解决“并城”的各种问题。

```
有多少种锁
```
进入王府，需要经过6道门，分别是同步门、阻塞门、状态门、排队门、重入门、共享门。
> **同组**的人带着兴奋的**状态排队重新进入**了**共享**汽车

同步门，有两道门，分别由2个门卫把手，他们性格不同，悲观门卫比较谨慎，他在有人做任务的时候，总是认为会有别的人闯进门来搞破坏，因此，他会在自己处理事情的时候先把门锁住，来确保没有别人闯进来；乐观门卫就不同了，他认为悲观门卫过于紧张了，他认为有人在做任务的时候，不会有别人闯进来，因此他不会先加锁，而是在他处理事情的时候会检查有没有人来搞破坏，如果有人来破坏了，那么他才根据不同的情况作处理，比如报错或者自己再重试。
> - 悲观门卫通常有2个人担任，synchronized和Lock的实现者
> - 乐观门卫通常由CAS担任，我们又叫他无锁

第二道是阻塞门，有2道门，只不过一个门一旦有人在做事就锁死了，因此这道门就阻塞住了，不能有别人再从这道门进入。另外一个是自旋门，它会一直转，是不阻塞的。

第三道是状态门，这道门会按照进入的人的等级，给你让不同量级的锁，分别是不加锁、偏向锁、轻锁、重锁。

第四道门叫排队门，我们会发现想进入的人在2个门前排好了队。一个门他的队排的井然有序，先到先进，这个门叫公平门；另外一个门也排着队，只不过每次有新人过来的时候，总是会插到第一个位置，有的成功插入了，有的插入失败，就去排队的，这个门叫非公平门。

第五道门叫重入门，也有2道，其中一道重入门，如果是同一个人进去办事，那就不会重新加锁上去；而另一道不可重入门，即使同一个人，也是要加锁的。

最后一道门叫共享门，也有2道，第一道共享门，它的锁上签了多个人的名字，如果是这些人进入，就可以打开这个锁。另一道叫排他门，也就是一把锁上只能有一个人的名字，不允许共用。
